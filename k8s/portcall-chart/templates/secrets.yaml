{{- if .Values.common.createSecret }}
# This secret is created automatically for local/dev environments (createSecret: true)
# For production, set createSecret: false and manage secrets externally via kubectl
# Production deployments using external S3 should create a separate 'spaces-credentials' secret:
#   kubectl create secret generic spaces-credentials \
#     --from-literal=AWS_ACCESS_KEY_ID="your-key" \
#     --from-literal=AWS_SECRET_ACCESS_KEY="your-secret"
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.common.secretName }}
  namespace: {{ .Values.global.namespace }}
type: Opaque
stringData:
  POSTGRES_USER: {{ .Values.postgresql.user | quote }}
  POSTGRES_PASSWORD: {{ .Values.postgresql.password | quote }}
  DATABASE_URL: "postgresql://{{ .Values.postgresql.user }}:{{ .Values.postgresql.password }}@{{ .Values.postgresql.host }}:{{ .Values.postgresql.port }}/{{ .Values.postgresql.database }}?sslmode=disable"
  AES_ENCRYPTION_KEY: {{ .Values.common.aesEncryptionKey | quote }}
  # S3/Object Storage Credentials (for MinIO or external S3)
  S3_ACCESS_KEY_ID: {{ .Values.common.s3AccessKeyId | quote }}
  S3_SECRET_ACCESS_KEY: {{ .Values.common.s3SecretAccessKey | quote }}
  # MinIO Root Credentials (only used when minio.enabled: true)
  MINIO_ROOT_USER: {{ .Values.minio.rootUser | quote }}
  MINIO_ROOT_PASSWORD: {{ .Values.minio.rootPassword | quote }}
  KC_BOOTSTRAP_ADMIN_USERNAME: {{ .Values.keycloak.adminUsername | quote }}
  KC_BOOTSTRAP_ADMIN_PASSWORD: {{ .Values.keycloak.adminPassword | quote }}
  KC_DB_USERNAME: {{ .Values.postgresql.user | quote }}
  KC_DB_PASSWORD: {{ .Values.postgresql.password | quote }}
  {{- if .Values.emailWorker.enabled }}
  {{- end }}
  {{- if .Values.common.dogfood }}
  PORTCALL_API_URL: {{ .Values.common.dogfood.apiUrl | default "http://api:8080" | quote }}
  {{- if .Values.common.dogfood.liveSecret }}
  DOGFOOD_LIVE_SECRET: {{ .Values.common.dogfood.liveSecret | quote }}
  {{- end }}
  {{- if .Values.common.dogfood.testSecret }}
  DOGFOOD_TEST_SECRET: {{ .Values.common.dogfood.testSecret | quote }}
  {{- end }}
  {{- end }}
{{- end }}
