<!doctype html>
<html>
  <head>
    <title>View invoice</title>
    {{template "view-styles"}}
  </head>
  <body style="margin: 0; padding: 0; background: var(--page-bg)">
    <div id="loading-overlay">
      <div class="spinner"></div>
      <div>Loading invoice‚Ä¶</div>
    </div>
    <button
      id="theme-btn"
      class="toolbar-btn"
      onclick="toggleTheme()"
      title="Toggle dark mode"
    >
      üåô
    </button>
    <button id="download-btn" class="toolbar-btn" onclick="printInvoice()">
      Download PDF
    </button>
    <div id="iframe-container">
      <iframe id="invoice-frame" src="{{.Src}}" allowfullscreen></iframe>
    </div>
    <script>
      function printInvoice() {
        var f = document.getElementById("invoice-frame");
        if (f && f.contentWindow) {
          f.contentWindow.focus();
          f.contentWindow.print();
        } else alert("Invoice not loaded yet.");
      }
      function syncIframeTheme(dark) {
        try {
          var doc = document.getElementById("invoice-frame").contentDocument;
          if (!doc) return;
          doc.documentElement.classList.toggle("dark", dark);
          doc.documentElement.classList.toggle("light", !dark);
        } catch (e) {}
      }
      function toggleTheme() {
        var html = document.documentElement;
        var isDark = html.classList.toggle("dark");
        html.classList.remove("light");
        if (!isDark) html.classList.add("light");
        localStorage.setItem("invoice-theme", isDark ? "dark" : "light");
        syncIframeTheme(isDark);
        document.getElementById("theme-btn").textContent = isDark ? "‚òÄÔ∏è" : "üåô";
      }
      (function () {
        var saved = localStorage.getItem("invoice-theme");
        if (saved === "dark") {
          document.documentElement.classList.add("dark");
          document.getElementById("theme-btn").textContent = "‚òÄÔ∏è";
        } else if (saved === "light") {
          document.documentElement.classList.add("light");
        }
      })();
      var overlay = document.getElementById("loading-overlay");
      document.getElementById("invoice-frame").onload = function () {
        overlay.style.display = "none";
        var saved = localStorage.getItem("invoice-theme");
        if (saved === "dark") syncIframeTheme(true);
        else if (saved === "light") syncIframeTheme(false);
      };
    </script>
  </body>
</html>
